"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[596],{1575:(e,t,s)=>{s.d(t,{A:()=>x,AuthProvider:()=>m});var a=s(5155),r=s(2115),n=s(9373),i=s(5041),d=s(8133),o=s(9436),l=s(5695);let c=(0,r.createContext)(null);function m(e){let{children:t}=e,{toast:s}=(0,o.dj)(),m=(0,l.useRouter)(),[x,u]=(0,r.useState)(()=>localStorage.getItem("accessToken"));(0,r.useEffect)(()=>{let e=e=>{"accessToken"===e.key&&u(e.newValue)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let{data:p,error:h,isLoading:f}=(0,n.I)({queryKey:["/api/user"],enabled:!!x,staleTime:3e5,gcTime:6e5,retry:1,queryFn:async()=>{if(!x)return null;try{let e=await fetch("https://api.neighborly.live/api/users/me",{headers:{Authorization:"Bearer ".concat(x),"Content-Type":"application/json"}});if(!e.ok){if(401===e.status||403===e.status)return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),u(null),d.qQ.setQueryData(["/api/user"],null),null;throw Error("Authentication failed: ".concat(e.status))}let t=await e.json();if(!t.success||!t.data)throw Error("Invalid response format");return t.data}catch(e){throw console.error("Auth query error:",e),console.log("Access token:",x),e instanceof Error&&e.message.includes("Authentication failed")&&(console.log("Clearing tokens due to auth failure"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),u(null),d.qQ.setQueryData(["/api/user"],null)),e}}}),g=(0,i.n)({mutationFn:async e=>{let t=await fetch("https://api.neighborly.live/api/auth/otp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to send OTP");return await t.json()},onSuccess:()=>{s({title:"OTP Sent",description:"Please check your phone for the verification code."})},onError:e=>{s({title:"Failed to send OTP",description:e.message,variant:"destructive"})}}),j=(0,i.n)({mutationFn:async e=>{let t=await fetch("https://api.neighborly.live/api/auth/otp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to verify OTP");return await t.json()},onSuccess:e=>{let{accessToken:t,refreshToken:a,user:r}=e.data;if("admin"!==r.role)return void s({title:"Access Denied",description:"You do not have permission to access the admin dashboard.",variant:"destructive"});localStorage.setItem("accessToken",t),localStorage.setItem("refreshToken",a),u(t),d.qQ.setQueryData(["/api/user"],r),s({title:"Login Successful",description:"Welcome to the admin dashboard!"}),m.push("/")},onError:e=>{s({title:"Verification Failed",description:e.message,variant:"destructive"})}});return(0,a.jsx)(c.Provider,{value:{user:null!=p?p:null,isLoading:f,error:h,accessToken:x,sendOtpMutation:g,verifyOtpMutation:j,logout:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),u(null),d.qQ.setQueryData(["/api/user"],null),d.qQ.clear(),m.push("/auth"),s({title:"Logged Out",description:"You have been successfully logged out."})}},children:t})}function x(){let e=(0,r.useContext)(c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},4143:(e,t,s)=>{s.d(t,{cn:()=>n});var a=s(2596),r=s(9688);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}},5930:(e,t,s)=>{s.d(t,{J:()=>l});var a=s(5155),r=s(2115),n=s(968),i=s(2085),d=s(4143);let o=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.b,{ref:t,className:(0,d.cn)(o(),s),...r})});l.displayName=n.b.displayName},8133:(e,t,s)=>{s.d(t,{qQ:()=>a});let a=new(s(7017)).E({defaultOptions:{queries:{staleTime:6e4,refetchOnWindowFocus:!1}}})},8496:(e,t,s)=>{s.d(t,{$:()=>l});var a=s(5155),r=s(2115),n=s(9708),i=s(2085),d=s(4143);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:l=!1,...c}=e,m=l?n.DX:"button";return(0,a.jsx)(m,{className:(0,d.cn)(o({variant:r,size:i,className:s})),ref:t,...c})});l.displayName="Button"},9436:(e,t,s)=>{s.d(t,{dj:()=>m});var a=s(2115);let r=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),l({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},d=[],o={toasts:[]};function l(e){o=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(o,e),d.forEach(e=>{e(o)})}function c(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>l({type:"DISMISS_TOAST",toastId:s});return l({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>l({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=a.useState(o);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>l({type:"DISMISS_TOAST",toastId:e})}}},9596:(e,t,s)=>{s.r(t),s.d(t,{default:()=>es});var a=s(5155),r=s(2115),n=s(9373),i=s(8496),d=s(2085),o=s(4143);let l=(0,d.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,o.cn)(l({variant:s}),t),...r})}let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});m.displayName="Card";let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",s),...r})});x.displayName="CardHeader";let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});u.displayName="CardTitle",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})}).displayName="CardDescription";let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",s),...r})});p.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,o.cn)("w-full caption-bottom text-sm",s),...r})})});h.displayName="Table";let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("thead",{ref:t,className:(0,o.cn)("[&_tr]:border-b",s),...r})});f.displayName="TableHeader";let g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,o.cn)("[&_tr:last-child]:border-0",s),...r})});g.displayName="TableBody",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,o.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let j=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,o.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});j.displayName="TableRow";let v=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,o.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});v.displayName="TableHead";let N=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,o.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});N.displayName="TableCell",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,o.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption";var b=s(4186),y=s(3453),w=s(4861),A=s(5525),k=s(4835),T=s(7580),_=s(2657);class S extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}async function R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=localStorage.getItem("accessToken"),a=await fetch("".concat("https://api.neighborly.live/api").concat(e),{...t,headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)},...t.headers}});if(!a.ok)throw new S(a.status,"HTTP ".concat(a.status,": ").concat(a.statusText));return await a.json()}let D={getDriverApplications:e=>R("/driver-applications".concat(e?"?status=".concat(e):"")),approveApplication:e=>R("/driver-applications/".concat(e,"/approve"),{method:"POST"}),rejectApplication:(e,t)=>R("/driver-applications/".concat(e,"/reject"),{method:"POST",body:JSON.stringify({reason:t})})};var C=s(5041),E=s(3651),P=s(4416);let F=E.bL;E.l9;let I=E.ZL;E.bm;let O=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(E.hJ,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});O.displayName=E.hJ.displayName;let M=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(I,{children:[(0,a.jsx)(O,{}),(0,a.jsxs)(E.UC,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[r,(0,a.jsxs)(E.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(P.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});M.displayName=E.UC.displayName;let q=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};q.displayName="DialogHeader";let z=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(E.hE,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});z.displayName=E.hE.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(E.VY,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})}).displayName=E.VY.displayName;var Q=s(5930);let V=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});V.displayName="Textarea";var L=s(1007),U=s(8883),$=s(9420),J=s(9074),B=s(4516),G=s(7930),H=s(7434),Y=s(3786),K=s(2486),W=s(8133),X=s(9436),Z=s(8184);function ee(e){let{application:t,isOpen:s,onClose:n}=e,{toast:d}=(0,X.dj)(),[o,l]=(0,r.useState)(!1),[c,m]=(0,r.useState)(""),x=(0,C.n)({mutationFn:()=>D.approveApplication(t.application_id),onSuccess:()=>{W.qQ.invalidateQueries({queryKey:["/api/driver-applications"]}),d({title:"Application Approved",description:"The driver application has been approved successfully."}),n()},onError:()=>{d({title:"Approval Failed",description:"Failed to approve the application. Please try again.",variant:"destructive"})}}),u=(0,C.n)({mutationFn:e=>D.rejectApplication(t.application_id,e),onSuccess:()=>{W.qQ.invalidateQueries({queryKey:["/api/driver-applications"]}),d({title:"Application Rejected",description:"The driver application has been rejected."}),n()},onError:()=>{d({title:"Rejection Failed",description:"Failed to reject the application. Please try again.",variant:"destructive"})}}),p=(e,t)=>{e?window.open(e,"_blank"):d({title:"Document Not Available",description:"".concat(t," document is not available."),variant:"destructive"})};return(0,a.jsx)(F,{open:s,onOpenChange:n,children:(0,a.jsx)(M,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0 border-0 shadow-notion-lg",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,a.jsxs)(q,{className:"px-6 py-4 border-b border-border",children:[(0,a.jsx)(z,{className:"text-lg font-semibold text-foreground",children:"Review Application"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[t.full_name," â€¢ Submitted ",(()=>{try{return t.created_at?(0,Z.GP)(new Date(t.created_at),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()]})]}),(0,a.jsxs)("div",{className:"px-6 py-6 space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-notion-blue rounded-lg flex items-center justify-center",children:(0,a.jsx)(L.A,{className:"h-4 w-4 text-notion-blue-dark"})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-foreground",children:"Personal Information"})]}),(0,a.jsx)("div",{className:"bg-notion-gray rounded-lg p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Full Name"})]}),(0,a.jsx)("p",{className:"text-sm font-medium text-foreground","data-testid":"text-full-name",children:t.full_name})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(U.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Email"})]}),(0,a.jsx)("p",{className:"text-sm text-foreground","data-testid":"text-email",children:t.email})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)($.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Phone Number"})]}),(0,a.jsx)("p",{className:"text-sm text-foreground","data-testid":"text-phone",children:t.phone_number})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(J.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Date of Birth"})]}),(0,a.jsx)("p",{className:"text-sm text-foreground","data-testid":"text-dob",children:(()=>{try{return t.date_of_birth?(0,Z.GP)(new Date(t.date_of_birth),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()})]}),(0,a.jsxs)("div",{className:"md:col-span-2 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Address"})]}),(0,a.jsx)("p",{className:"text-sm text-foreground","data-testid":"text-address",children:t.address})]})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-notion-purple rounded-lg flex items-center justify-center",children:(0,a.jsx)(G.A,{className:"h-4 w-4 text-notion-purple-dark"})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-foreground",children:"Vehicle Information"})]}),(0,a.jsx)("div",{className:"bg-notion-gray rounded-lg p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Vehicle"}),(0,a.jsxs)("p",{className:"text-sm font-medium text-foreground","data-testid":"text-car-name",children:[t.car.car_name," ",t.car.car_model]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"License Plate"}),(0,a.jsx)("p",{className:"text-sm text-foreground font-mono","data-testid":"text-license-plate",children:t.car.license_plate})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Color"}),(0,a.jsx)("p",{className:"text-sm text-foreground capitalize","data-testid":"text-car-color",children:t.car.car_color})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Year"}),(0,a.jsx)("p",{className:"text-sm text-foreground","data-testid":"text-car-year",children:t.car.car_year||"Not specified"})]})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-notion-green rounded-lg flex items-center justify-center",children:(0,a.jsx)(H.A,{className:"h-4 w-4 text-notion-green-dark"})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-foreground",children:"Documents"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"notion-card p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-notion-blue rounded-lg flex items-center justify-center",children:(0,a.jsx)(H.A,{className:"h-5 w-5 text-notion-blue-dark"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-foreground",children:"Driving License"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Expires ",(()=>{try{return t.driving_license_expiry_date?(0,Z.GP)(new Date(t.driving_license_expiry_date),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()]})]})]}),(0,a.jsxs)(i.$,{size:"sm",variant:"ghost",className:"w-full justify-start text-notion-blue-dark hover:bg-notion-blue",onClick:()=>p(t.driving_license_url,"Driving License"),"data-testid":"button-view-license",children:[(0,a.jsx)(Y.A,{className:"h-4 w-4 mr-2"}),"View Document"]})]}),(0,a.jsxs)("div",{className:"notion-card p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-notion-green rounded-lg flex items-center justify-center",children:(0,a.jsx)(H.A,{className:"h-5 w-5 text-notion-green-dark"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-foreground",children:"Insurance"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:t.insurance_document_number}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Expires ",(()=>{try{return t.insurance_expiry_date?(0,Z.GP)(new Date(t.insurance_expiry_date),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()]})]})]}),(0,a.jsxs)(i.$,{size:"sm",variant:"ghost",className:"w-full justify-start text-notion-green-dark hover:bg-notion-green",onClick:()=>p(t.insurance_document_url,"Insurance"),"data-testid":"button-view-insurance",children:[(0,a.jsx)(Y.A,{className:"h-4 w-4 mr-2"}),"View Document"]})]}),(0,a.jsxs)("div",{className:"notion-card p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-notion-purple rounded-lg flex items-center justify-center",children:(0,a.jsx)(H.A,{className:"h-5 w-5 text-notion-purple-dark"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-foreground",children:"Car Sticker"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Vehicle identification"})]})]}),(0,a.jsxs)(i.$,{size:"sm",variant:"ghost",className:"w-full justify-start text-notion-purple-dark hover:bg-notion-purple",onClick:()=>p(t.car_sticker_url,"Car Sticker"),"data-testid":"button-view-sticker",children:[(0,a.jsx)(Y.A,{className:"h-4 w-4 mr-2"}),"View Document"]})]})]})]}),o&&(0,a.jsxs)("div",{className:"bg-notion-red rounded-lg p-4",children:[(0,a.jsx)(Q.J,{htmlFor:"rejectionReason",className:"text-sm font-medium text-foreground mb-3 block",children:"Rejection Reason"}),(0,a.jsx)(V,{id:"rejectionReason",rows:3,className:"w-full border-border bg-white",placeholder:"Please provide a detailed reason for rejection...",value:c,onChange:e=>m(e.target.value),"data-testid":"textarea-rejection-reason"})]})]}),(0,a.jsx)("div",{className:"px-6 py-4 border-t border-border bg-notion-gray-light",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,a.jsx)(i.$,{className:"flex-1 bg-notion-green-dark text-white hover:bg-green-700 shadow-sm",onClick:()=>{x.mutate()},disabled:"pending"!==t.status||x.isPending||u.isPending,"data-testid":"button-approve",children:x.isPending?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Approving..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Approve"]})}),(0,a.jsx)(i.$,{variant:"destructive",className:"flex-1 bg-notion-red-dark text-white hover:bg-red-700 shadow-sm",onClick:()=>o?c.trim()?void u.mutate(c):void d({title:"Rejection Reason Required",description:"Please provide a reason for rejection.",variant:"destructive"}):void l(!0),disabled:"pending"!==t.status||x.isPending||u.isPending,"data-testid":"button-reject",children:u.isPending?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Rejecting..."})]}):o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"Send Rejection"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Reject"]})})]})})]})})})}var et=s(1575);function es(){let{user:e,logout:t}=(0,et.A)(),[s,d]=(0,r.useState)(null),[o,l]=(0,r.useState)(!1),{data:S,isLoading:R,error:C}=(0,n.I)({queryKey:["/api/driver-applications"],queryFn:()=>D.getDriverApplications()}),E={total:(null==S?void 0:S.length)||0,pending:(null==S?void 0:S.filter(e=>"pending"===e.status).length)||0,approved:(null==S?void 0:S.filter(e=>"approved"===e.status).length)||0,rejected:(null==S?void 0:S.filter(e=>"rejected"===e.status).length)||0};return R?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 bg-foreground rounded-lg flex items-center justify-center mx-auto",children:(0,a.jsx)("div",{className:"h-8 w-8 border-4 border-white border-t-transparent rounded-full animate-spin"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Loading Dashboard..."}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fetching driver applications"})]})]})}):C?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 bg-red-100 rounded-full flex items-center justify-center mx-auto",children:(0,a.jsx)(w.A,{className:"h-8 w-8 text-red-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Error Loading Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Failed to fetch driver applications. Please try again."})]})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-notion-gray-light",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"h-12 w-12 bg-foreground rounded-lg flex items-center justify-center",children:(0,a.jsx)(A.A,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Neighborly Admin"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Driver Application Management"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-foreground",children:null==e?void 0:e.name}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground capitalize",children:[null==e?void 0:e.role," Access"]})]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:t,className:"border-gray-300 hover:bg-gray-50","data-testid":"button-logout",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Logout"]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)(m,{className:"notion-card",children:[(0,a.jsxs)(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-muted-foreground",children:"Total Applications"}),(0,a.jsx)(T.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"stat-total",children:E.total})})]}),(0,a.jsxs)(m,{className:"notion-card",children:[(0,a.jsxs)(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-muted-foreground",children:"Pending Review"}),(0,a.jsx)(b.A,{className:"h-4 w-4 text-yellow-500"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600","data-testid":"stat-pending",children:E.pending})})]}),(0,a.jsxs)(m,{className:"notion-card",children:[(0,a.jsxs)(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600","data-testid":"stat-approved",children:E.approved})})]}),(0,a.jsxs)(m,{className:"notion-card",children:[(0,a.jsxs)(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-muted-foreground",children:"Rejected"}),(0,a.jsx)(w.A,{className:"h-4 w-4 text-red-500"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600","data-testid":"stat-rejected",children:E.rejected})})]})]}),(0,a.jsxs)(m,{className:"notion-card",children:[(0,a.jsxs)(x,{children:[(0,a.jsx)(u,{className:"text-lg font-semibold text-foreground",children:"Driver Applications"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Review and manage driver applications for Neighborly"})]}),(0,a.jsxs)(p,{className:"p-0",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(f,{children:(0,a.jsxs)(j,{className:"border-b border-gray-200",children:[(0,a.jsx)(v,{className:"font-medium text-muted-foreground",children:"Driver"}),(0,a.jsx)(v,{className:"font-medium text-muted-foreground",children:"Contact"}),(0,a.jsx)(v,{className:"font-medium text-muted-foreground",children:"Vehicle"}),(0,a.jsx)(v,{className:"font-medium text-muted-foreground",children:"Status"}),(0,a.jsx)(v,{className:"font-medium text-muted-foreground",children:"Actions"})]})}),(0,a.jsx)(g,{children:null==S?void 0:S.map(e=>{var t;return(0,a.jsxs)(j,{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,a.jsx)(N,{className:"py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-foreground","data-testid":"text-name-".concat(e.application_id),children:e.full_name}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["ID: ",null==(t=e.application_id)?void 0:t.slice(0,8),"..."]})]})}),(0,a.jsx)(N,{className:"py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-foreground",children:e.email}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:e.phone_number})]})}),(0,a.jsx)(N,{className:"py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-foreground",children:[e.car.car_name," ",e.car.car_model]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground font-mono",children:e.car.license_plate})]})}),(0,a.jsx)(N,{className:"py-4",children:(e=>{switch(e){case"pending":return(0,a.jsxs)(c,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:[(0,a.jsx)(b.A,{className:"h-3 w-3 mr-1"}),"Pending"]});case"approved":return(0,a.jsxs)(c,{variant:"secondary",className:"bg-green-100 text-green-800 hover:bg-green-200",children:[(0,a.jsx)(y.A,{className:"h-3 w-3 mr-1"}),"Approved"]});case"rejected":return(0,a.jsxs)(c,{variant:"secondary",className:"bg-red-100 text-red-800 hover:bg-red-200",children:[(0,a.jsx)(w.A,{className:"h-3 w-3 mr-1"}),"Rejected"]});default:return(0,a.jsx)(c,{variant:"outline",children:e})}})(e.status)}),(0,a.jsx)(N,{className:"py-4",children:(0,a.jsxs)(i.$,{size:"sm",variant:"outline",onClick:()=>{d(e),l(!0)},className:"border-gray-300 hover:bg-gray-50","data-testid":"button-review-".concat(e.application_id),children:[(0,a.jsx)(_.A,{className:"h-4 w-4 mr-1"}),"Review"]})})]},e.application_id)})})]}),(null==S?void 0:S.length)===0&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(T.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No Applications Found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"There are currently no driver applications to review."})]})]})]})]}),s&&(0,a.jsx)(ee,{application:s,isOpen:o,onClose:()=>{l(!1),d(null)}})]})}}}]);