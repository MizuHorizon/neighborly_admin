(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1089:(e,t,o)=>{"use strict";o.d(t,{TooltipProvider:()=>n});var r=o(5155),s=o(2115),a=o(1764),i=o(4143);let n=a.Kq;a.bL,a.l9,s.forwardRef((e,t)=>{let{className:o,sideOffset:s=4,...n}=e;return(0,r.jsx)(a.UC,{ref:t,sideOffset:s,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",o),...n})}).displayName=a.UC.displayName},1575:(e,t,o)=>{"use strict";o.d(t,{A:()=>h,AuthProvider:()=>c});var r=o(5155),s=o(2115),a=o(9373),i=o(5041),n=o(8133),l=o(9436),u=o(5695);let d=(0,s.createContext)(null);function c(e){let{children:t}=e,{toast:o}=(0,l.dj)(),c=(0,u.useRouter)(),[h,f]=(0,s.useState)(()=>localStorage.getItem("accessToken"));(0,s.useEffect)(()=>{let e=e=>{"accessToken"===e.key&&f(e.newValue)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let{data:p,error:m,isLoading:v}=(0,a.I)({queryKey:["/api/user"],enabled:!!h,staleTime:3e5,gcTime:6e5,retry:1,queryFn:async()=>{if(!h)return null;try{let e=await fetch("https://api.neighborly.live/api/users/me",{headers:{Authorization:"Bearer ".concat(h),"Content-Type":"application/json"}});if(!e.ok){if(401===e.status||403===e.status)return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),f(null),n.qQ.setQueryData(["/api/user"],null),null;throw Error("Authentication failed: ".concat(e.status))}let t=await e.json();if(!t.success||!t.data)throw Error("Invalid response format");return t.data}catch(e){throw console.error("Auth query error:",e),console.log("Access token:",h),e instanceof Error&&e.message.includes("Authentication failed")&&(console.log("Clearing tokens due to auth failure"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),f(null),n.qQ.setQueryData(["/api/user"],null)),e}}}),T=(0,i.n)({mutationFn:async e=>{let t=await fetch("https://api.neighborly.live/api/auth/otp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to send OTP");return await t.json()},onSuccess:()=>{o({title:"OTP Sent",description:"Please check your phone for the verification code."})},onError:e=>{o({title:"Failed to send OTP",description:e.message,variant:"destructive"})}}),S=(0,i.n)({mutationFn:async e=>{let t=await fetch("https://api.neighborly.live/api/auth/otp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to verify OTP");return await t.json()},onSuccess:e=>{let{accessToken:t,refreshToken:r,user:s}=e.data;if("admin"!==s.role)return void o({title:"Access Denied",description:"You do not have permission to access the admin dashboard.",variant:"destructive"});localStorage.setItem("accessToken",t),localStorage.setItem("refreshToken",r),f(t),n.qQ.setQueryData(["/api/user"],s),o({title:"Login Successful",description:"Welcome to the admin dashboard!"}),c.push("/")},onError:e=>{o({title:"Verification Failed",description:e.message,variant:"destructive"})}});return(0,r.jsx)(d.Provider,{value:{user:null!=p?p:null,isLoading:v,error:m,accessToken:h,sendOtpMutation:T,verifyOtpMutation:S,logout:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),f(null),n.qQ.setQueryData(["/api/user"],null),n.qQ.clear(),c.push("/auth"),o({title:"Logged Out",description:"You have been successfully logged out."})}},children:t})}function h(){let e=(0,s.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},2975:(e,t,o)=>{Promise.resolve().then(o.bind(o,1089)),Promise.resolve().then(o.t.bind(o,9324,23)),Promise.resolve().then(o.bind(o,1575)),Promise.resolve().then(o.bind(o,8558)),Promise.resolve().then(o.bind(o,3888)),Promise.resolve().then(o.t.bind(o,5299,23))},4143:(e,t,o)=>{"use strict";o.d(t,{cn:()=>a});var r=o(2596),s=o(9688);function a(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,s.QP)((0,r.$)(t))}},8133:(e,t,o)=>{"use strict";o.d(t,{qQ:()=>r});let r=new(o(7017)).E({defaultOptions:{queries:{staleTime:6e4,refetchOnWindowFocus:!1}}})},8558:(e,t,o)=>{"use strict";o.d(t,{QueryProvider:()=>n});var r=o(5155),s=o(7017),a=o(6715),i=o(2115);function n(e){let{children:t}=e,[o]=(0,i.useState)(()=>new s.E({defaultOptions:{queries:{staleTime:6e4,refetchOnWindowFocus:!1}}}));return(0,r.jsx)(a.Ht,{client:o,children:t})}},9324:()=>{},9436:(e,t,o)=>{"use strict";o.d(t,{dj:()=>c});var r=o(2115);let s=0,a=new Map,i=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},n=[],l={toasts:[]};function u(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:o}=t;return o?i(o):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===o||void 0===o?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),n.forEach(e=>{e(l)})}function d(e){let{...t}=e,o=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>u({type:"DISMISS_TOAST",toastId:o});return u({type:"ADD_TOAST",toast:{...t,id:o,open:!0,onOpenChange:e=>{e||r()}}}),{id:o,dismiss:r,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:o}})}}function c(){let[e,t]=r.useState(l);return r.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}}},e=>{e.O(0,[618,305,977,601,441,964,358],()=>e(e.s=2975)),_N_E=e.O()}]);