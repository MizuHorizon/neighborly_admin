"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[596],{1575:(e,t,s)=>{s.d(t,{A:()=>m,AuthProvider:()=>x});var a=s(5155),n=s(2115),r=s(2960),i=s(5041),o=s(8133),l=s(9436),d=s(5695);let c=(0,n.createContext)(null);function x(e){let{children:t}=e,{toast:s}=(0,l.dj)(),x=(0,d.useRouter)(),[m,u]=(0,n.useState)(null),[p,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{u(localStorage.getItem("accessToken")),h(!0)},[]),(0,n.useEffect)(()=>{let e=e=>{"accessToken"===e.key&&u(e.newValue)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let{data:f,error:g,isLoading:j}=(0,r.I)({queryKey:["/api/user"],enabled:!!m&&p,staleTime:3e5,gcTime:6e5,retry:1,queryFn:async()=>{if(!m)return null;try{let e=await fetch("https://api.neighborly.live/api/users/me",{headers:{Authorization:"Bearer ".concat(m),"Content-Type":"application/json"}});if(!e.ok){if(401===e.status||403===e.status)return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),u(null),o.qQ.setQueryData(["/api/user"],null),null;throw Error("Authentication failed: ".concat(e.status))}let t=await e.json();if(!t.success||!t.data)throw Error("Invalid response format");return t.data}catch(e){throw console.error("Auth query error:",e),console.log("Access token:",m),e instanceof Error&&e.message.includes("Authentication failed")&&(console.log("Clearing tokens due to auth failure"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),u(null),o.qQ.setQueryData(["/api/user"],null)),e}}}),b=(0,i.n)({mutationFn:async e=>{let t=await fetch("https://api.neighborly.live/api/auth/otp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to send OTP");return await t.json()},onSuccess:()=>{s({title:"OTP Sent",description:"Please check your phone for the verification code."})},onError:e=>{s({title:"Failed to send OTP",description:e.message,variant:"destructive"})}}),v=(0,i.n)({mutationFn:async e=>{let t=await fetch("https://api.neighborly.live/api/auth/otp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to verify OTP");return await t.json()},onSuccess:e=>{let{accessToken:t,refreshToken:a,user:n}=e.data;if("admin"!==n.role)return void s({title:"Access Denied",description:"You do not have permission to access the admin dashboard.",variant:"destructive"});localStorage.setItem("accessToken",t),localStorage.setItem("refreshToken",a),u(t),o.qQ.setQueryData(["/api/user"],n),s({title:"Login Successful",description:"Welcome to the admin dashboard!"}),x.push("/")},onError:e=>{s({title:"Verification Failed",description:e.message,variant:"destructive"})}});return(0,a.jsx)(c.Provider,{value:{user:null!=f?f:null,isLoading:!p||j,error:g,accessToken:m,sendOtpMutation:b,verifyOtpMutation:v,logout:()=>{console.log("Logout function called"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),console.log("LocalStorage cleared"),u(null),console.log("Access token state cleared"),o.qQ.setQueryData(["/api/user"],null),o.qQ.clear(),console.log("Query cache cleared"),s({title:"Logged Out",description:"You have been successfully logged out."}),console.log("Navigating to /auth"),x.push("/auth")}},children:t})}function m(){let e=(0,n.useContext)(c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},4143:(e,t,s)=>{s.d(t,{cn:()=>r});var a=s(2596),n=s(9688);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.QP)((0,a.$)(t))}},5930:(e,t,s)=>{s.d(t,{J:()=>d});var a=s(5155),n=s(2115),r=s(968),i=s(2085),o=s(4143);let l=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.b,{ref:t,className:(0,o.cn)(l(),s),...n})});d.displayName=r.b.displayName},8133:(e,t,s)=>{s.d(t,{qQ:()=>a});let a=new(s(7017)).E({defaultOptions:{queries:{staleTime:6e4,refetchOnWindowFocus:!1}}})},8496:(e,t,s)=>{s.d(t,{$:()=>d});var a=s(5155),n=s(2115),r=s(9708),i=s(2085),o=s(4143);let l=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:s,variant:n,size:i,asChild:d=!1,...c}=e,x=d?r.DX:"button";return(0,a.jsx)(x,{className:(0,o.cn)(l({variant:n,size:i,className:s})),ref:t,...c})});d.displayName="Button"},9436:(e,t,s)=>{s.d(t,{dj:()=>x});var a=s(2115);let n=0,r=new Map,i=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},o=[],l={toasts:[]};function d(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),o.forEach(e=>{e(l)})}function c(e){let{...t}=e,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function x(){let[e,t]=a.useState(l);return a.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},9596:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ea});var a=s(5155),n=s(2115),r=s(2960),i=s(8496),o=s(2085),l=s(4143);let d=(0,o.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{className:(0,l.cn)(d({variant:s}),t),...n})}let x=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});x.displayName="Card";let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...n})});m.displayName="CardHeader";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});u.displayName="CardTitle",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...n})}).displayName="CardDescription";let p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...n})});p.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter";let h=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...n})})});h.displayName="Table";let f=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...n})});f.displayName="TableHeader";let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...n})});g.displayName="TableBody",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...n})}).displayName="TableFooter";let j=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...n})});j.displayName="TableRow";let b=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...n})});b.displayName="TableHead";let v=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...n})});v.displayName="TableCell",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...n})}).displayName="TableCaption";var N=s(4186),y=s(3453),w=s(4861),A=s(5525),k=s(4835),T=s(7580),_=s(2657);let S="https://api.neighborly.live/api";class R extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}async function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=localStorage.getItem("accessToken");console.log("Making API request to: ".concat(S).concat(e)),console.log("Request options:",t),console.log("Access token:",s?"Present":"Missing");let a=await fetch("".concat(S).concat(e),{...t,headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)},...t.headers}});if(console.log("Response status:",a.status),console.log("Response headers:",Object.fromEntries(a.headers.entries())),!a.ok){let t="HTTP ".concat(a.status,": ").concat(a.statusText);try{let e=await a.json();e.message?t=e.message:e.error&&(t=e.error)}catch(e){}throw console.error("API request failed:",{endpoint:e,status:a.status,statusText:a.statusText,errorMessage:t}),new R(a.status,t)}let n=await a.json();return console.log("API response data:",n),n}let E={getDriverApplications:e=>C("/driver-applications".concat(e?"?status=".concat(e):"")),approveApplication:e=>C("/driver-applications/".concat(e,"/approve"),{method:"POST",headers:{"Content-Type":"application/json"}}),rejectApplication:(e,t)=>C("/driver-applications/".concat(e,"/reject"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:t})})};var P=s(5041),D=s(3651),I=s(4416);let O=D.bL;D.l9;let F=D.ZL;D.bm;let M=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(D.hJ,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n})});M.displayName=D.hJ.displayName;let q=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)(F,{children:[(0,a.jsx)(M,{}),(0,a.jsxs)(D.UC,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:[n,(0,a.jsxs)(D.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(I.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});q.displayName=D.UC.displayName;let z=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};z.displayName="DialogHeader";let Q=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(D.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",s),...n})});Q.displayName=D.hE.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(D.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...n})}).displayName=D.VY.displayName;var L=s(5930);let V=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});V.displayName="Textarea";var U=s(1007),$=s(8883),J=s(9420),B=s(9074),G=s(4516),H=s(7930),Y=s(7434),K=s(3786),W=s(2486),X=s(8133),Z=s(9436),ee=s(8184);function et(e){let{application:t,isOpen:s,onClose:r}=e,{toast:o}=(0,Z.dj)(),[l,d]=(0,n.useState)(!1),[c,x]=(0,n.useState)("");console.log("ApplicationModal rendered:",{isOpen:s,applicationId:null==t?void 0:t.application_id,status:null==t?void 0:t.status,showRejectionInput:l,rejectionReason:c});let m=(0,P.n)({mutationFn:()=>(console.log("Approving application:",t.application_id),E.approveApplication(t.application_id)),onSuccess:e=>{console.log("Approval successful:",e),X.qQ.invalidateQueries({queryKey:["/api/driver-applications"]}),o({title:"Application Approved",description:"The driver application has been approved successfully."}),r()},onError:e=>{console.error("Approval failed:",e),o({title:"Approval Failed",description:e instanceof Error?e.message:"Failed to approve the application. Please try again.",variant:"destructive"})}}),u=(0,P.n)({mutationFn:e=>(console.log("Rejecting application:",t.application_id,"with reason:",e),E.rejectApplication(t.application_id,e)),onSuccess:e=>{console.log("Rejection successful:",e),X.qQ.invalidateQueries({queryKey:["/api/driver-applications"]}),o({title:"Application Rejected",description:"The driver application has been rejected."}),r()},onError:e=>{console.error("Rejection failed:",e),o({title:"Rejection Failed",description:e instanceof Error?e.message:"Failed to reject the application. Please try again.",variant:"destructive"})}}),p=(e,t)=>{e?window.open(e,"_blank"):o({title:"Document Not Available",description:"".concat(t," document is not available."),variant:"destructive"})};return(0,a.jsx)(O,{open:s,onOpenChange:r,children:(0,a.jsx)(q,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0 border-0 shadow-notion-lg",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,a.jsxs)(z,{className:"px-6 py-4 border-b border-notion-border",children:[(0,a.jsx)(Q,{className:"text-lg font-semibold text-notion-text",children:"Review Application"}),(0,a.jsxs)("p",{className:"text-sm text-notion-text-muted mt-1",children:[t.full_name," â€¢ Submitted ",(()=>{try{return t.created_at?(0,ee.GP)(new Date(t.created_at),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()]})]}),(0,a.jsxs)("div",{className:"px-6 py-6 space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-notion-black rounded-lg flex items-center justify-center",children:(0,a.jsx)(U.A,{className:"h-4 w-4 text-white"})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-notion-text",children:"Personal Information"})]}),(0,a.jsx)("div",{className:"bg-notion-gray rounded-lg p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(U.A,{className:"h-4 w-4 text-notion-text-muted"}),(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Full Name"})]}),(0,a.jsx)("p",{className:"text-sm font-medium text-notion-text","data-testid":"text-full-name",children:t.full_name})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)($.A,{className:"h-4 w-4 text-notion-text-muted"}),(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Email"})]}),(0,a.jsx)("p",{className:"text-sm text-notion-text","data-testid":"text-email",children:t.email})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(J.A,{className:"h-4 w-4 text-notion-text-muted"}),(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Phone Number"})]}),(0,a.jsx)("p",{className:"text-sm text-notion-text","data-testid":"text-phone",children:t.phone_number})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 text-notion-text-muted"}),(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Date of Birth"})]}),(0,a.jsx)("p",{className:"text-sm text-notion-text","data-testid":"text-dob",children:(()=>{try{return t.date_of_birth?(0,ee.GP)(new Date(t.date_of_birth),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()})]}),(0,a.jsxs)("div",{className:"md:col-span-2 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(G.A,{className:"h-4 w-4 text-notion-text-muted"}),(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Address"})]}),(0,a.jsx)("p",{className:"text-sm text-notion-text","data-testid":"text-address",children:t.address})]})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-notion-black rounded-lg flex items-center justify-center",children:(0,a.jsx)(H.A,{className:"h-4 w-4 text-white"})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-notion-text",children:"Vehicle Information"})]}),(0,a.jsx)("div",{className:"bg-notion-gray rounded-lg p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Vehicle"}),(0,a.jsxs)("p",{className:"text-sm font-medium text-notion-text","data-testid":"text-car-name",children:[t.car.car_name," ",t.car.car_model]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"License Plate"}),(0,a.jsx)("p",{className:"text-sm text-notion-text font-mono","data-testid":"text-license-plate",children:t.car.license_plate})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Color"}),(0,a.jsx)("p",{className:"text-sm text-notion-text capitalize","data-testid":"text-car-color",children:t.car.car_color})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-notion-text-muted uppercase tracking-wider",children:"Year"}),(0,a.jsx)("p",{className:"text-sm text-notion-text","data-testid":"text-car-year",children:t.car.car_year||"Not specified"})]})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-notion-black rounded-lg flex items-center justify-center",children:(0,a.jsx)(Y.A,{className:"h-4 w-4 text-white"})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-notion-text",children:"Documents"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white border border-notion-border rounded-lg p-4 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-notion-black rounded-lg flex items-center justify-center",children:(0,a.jsx)(Y.A,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-notion-text",children:"Driving License"}),(0,a.jsxs)("p",{className:"text-xs text-notion-text-muted",children:["Expires ",(()=>{try{return t.driving_license_expiry_date?(0,ee.GP)(new Date(t.driving_license_expiry_date),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()]})]})]}),(0,a.jsxs)(i.$,{size:"sm",variant:"ghost",className:"w-full justify-start text-notion-text hover:bg-notion-gray transition-colors duration-200",onClick:()=>p(t.driving_license_url,"Driving License"),"data-testid":"button-view-license",children:[(0,a.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"View Document"]})]}),(0,a.jsxs)("div",{className:"bg-white border border-notion-border rounded-lg p-4 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-notion-black rounded-lg flex items-center justify-center",children:(0,a.jsx)(Y.A,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-notion-text",children:"Insurance"}),(0,a.jsx)("p",{className:"text-xs text-notion-text-muted",children:t.insurance_document_number}),(0,a.jsxs)("p",{className:"text-xs text-notion-text-muted",children:["Expires ",(()=>{try{return t.insurance_expiry_date?(0,ee.GP)(new Date(t.insurance_expiry_date),"MMM dd, yyyy"):"Unknown date"}catch(e){return"Unknown date"}})()]})]})]}),(0,a.jsxs)(i.$,{size:"sm",variant:"ghost",className:"w-full justify-start text-notion-text hover:bg-notion-gray transition-colors duration-200",onClick:()=>p(t.insurance_document_url,"Insurance"),"data-testid":"button-view-insurance",children:[(0,a.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"View Document"]})]}),(0,a.jsxs)("div",{className:"bg-white border border-notion-border rounded-lg p-4 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-notion-black rounded-lg flex items-center justify-center",children:(0,a.jsx)(Y.A,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-notion-text",children:"Car Sticker"}),(0,a.jsx)("p",{className:"text-xs text-notion-text-muted",children:"Vehicle identification"})]})]}),(0,a.jsxs)(i.$,{size:"sm",variant:"ghost",className:"w-full justify-start text-notion-text hover:bg-notion-gray transition-colors duration-200",onClick:()=>p(t.car_sticker_url,"Car Sticker"),"data-testid":"button-view-sticker",children:[(0,a.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"View Document"]})]})]})]}),l&&(0,a.jsxs)("div",{className:"bg-notion-gray rounded-lg p-4 border border-notion-border",children:[(0,a.jsx)(L.J,{htmlFor:"rejectionReason",className:"text-sm font-medium text-notion-text mb-3 block",children:"Rejection Reason"}),(0,a.jsx)(V,{id:"rejectionReason",rows:3,className:"w-full border-notion-border bg-white text-notion-text placeholder:text-notion-text-light focus:border-notion-black focus:ring-notion-black/20 focus:ring-2 transition-all duration-200",placeholder:"Please provide a detailed reason for rejection...",value:c,onChange:e=>x(e.target.value),"data-testid":"textarea-rejection-reason"})]})]}),(0,a.jsx)("div",{className:"px-6 py-4 border-t border-notion-border bg-notion-gray-light",style:{position:"relative",zIndex:10},children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,a.jsxs)("div",{className:"w-full text-xs text-notion-text-muted mb-2",children:["Debug: Status: ",t.status," | Can Approve: ","pending"===t.status," | Can Reject: ","pending"===t.status]}),(0,a.jsx)(i.$,{className:"w-full bg-blue-500 text-white mb-2",onClick:()=>{console.log("Test button clicked!"),alert("Test button works!")},style:{position:"relative",zIndex:20},children:"Test Button - Click Me!"}),(0,a.jsx)(i.$,{className:"flex-1 bg-notion-black text-white hover:bg-notion-text-muted shadow-sm transition-colors duration-200",onClick:()=>{if(console.log("Approve button clicked for application:",t.application_id),console.log("Current application status:",t.status),console.log("Mutation state:",{isPending:m.isPending,isError:m.isError}),"pending"!==t.status){console.log("Cannot approve - application status is not pending"),o({title:"Cannot Approve",description:"Only pending applications can be approved.",variant:"destructive"});return}m.mutate()},disabled:"pending"!==t.status||m.isPending||u.isPending,"data-testid":"button-approve",style:{position:"relative",zIndex:20},children:m.isPending?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Approving..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Approve"]})}),(0,a.jsx)(i.$,{variant:"destructive",className:"flex-1 bg-notion-text-muted text-white hover:bg-notion-text shadow-sm transition-colors duration-200",onClick:()=>{if(console.log("Reject button clicked for application:",t.application_id),console.log("Current application status:",t.status),console.log("Show rejection input:",l),console.log("Rejection reason:",c),"pending"!==t.status){console.log("Cannot reject - application status is not pending"),o({title:"Cannot Reject",description:"Only pending applications can be rejected.",variant:"destructive"});return}if(!l){console.log("Showing rejection input"),d(!0);return}if(!c.trim()){console.log("Rejection reason is empty"),o({title:"Rejection Reason Required",description:"Please provide a reason for rejection.",variant:"destructive"});return}console.log("Submitting rejection with reason:",c),u.mutate(c)},disabled:"pending"!==t.status||m.isPending||u.isPending,"data-testid":"button-reject",style:{position:"relative",zIndex:20},children:u.isPending?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Rejecting..."})]}):l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(W.A,{className:"h-4 w-4 mr-2"}),"Send Rejection"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Reject"]})})]})})]})})})}var es=s(1575);function ea(){let{user:e,logout:t}=(0,es.A)(),[s,o]=(0,n.useState)(null),[l,d]=(0,n.useState)(!1),{data:S,isLoading:R,error:C}=(0,r.I)({queryKey:["/api/driver-applications"],queryFn:()=>E.getDriverApplications()}),P=(null==S?void 0:S.data)||[],D={total:P.length||0,pending:P.filter(e=>"pending"===e.status).length||0,approved:P.filter(e=>"approved"===e.status).length||0,rejected:P.filter(e=>"rejected"===e.status).length||0};return R?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 bg-foreground rounded-lg flex items-center justify-center mx-auto",children:(0,a.jsx)("div",{className:"h-8 w-8 border-4 border-white border-t-transparent rounded-full animate-spin"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Loading Dashboard..."}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fetching driver applications"})]})]})}):C?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 bg-red-100 rounded-full flex items-center justify-center mx-auto",children:(0,a.jsx)(w.A,{className:"h-8 w-8 text-red-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Error Loading Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Failed to fetch driver applications. Please try again."})]})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-notion-gray-light",children:[(0,a.jsx)("div",{className:"bg-white border-b border-notion-border shadow-sm",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"h-12 w-12 bg-notion-black rounded-lg flex items-center justify-center",children:(0,a.jsx)(A.A,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-notion-text",children:"Neighborly Admin"}),(0,a.jsx)("p",{className:"text-sm text-notion-text-muted",children:"Driver Application Management"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-notion-text",children:null==e?void 0:e.name}),(0,a.jsxs)("p",{className:"text-xs text-notion-text-muted capitalize",children:[null==e?void 0:e.role," Access"]})]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:t,className:"border-notion-border hover:bg-notion-gray text-notion-text hover:text-notion-text transition-colors duration-200","data-testid":"button-logout",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Logout"]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)(x,{className:"bg-white border border-notion-border rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200",children:[(0,a.jsxs)(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-notion-text-muted",children:"Total Applications"}),(0,a.jsx)(T.A,{className:"h-4 w-4 text-notion-text-light"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-notion-text","data-testid":"stat-total",children:D.total})})]}),(0,a.jsxs)(x,{className:"bg-white border border-notion-border rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200",children:[(0,a.jsxs)(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-notion-text-muted",children:"Pending Review"}),(0,a.jsx)(N.A,{className:"h-4 w-4 text-notion-text-muted"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-notion-text","data-testid":"stat-pending",children:D.pending})})]}),(0,a.jsxs)(x,{className:"bg-white border border-notion-border rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200",children:[(0,a.jsxs)(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-notion-text-muted",children:"Approved"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-notion-text-muted"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-notion-text","data-testid":"stat-approved",children:D.approved})})]}),(0,a.jsxs)(x,{className:"bg-white border border-notion-border rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200",children:[(0,a.jsxs)(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(u,{className:"text-sm font-medium text-notion-text-muted",children:"Rejected"}),(0,a.jsx)(w.A,{className:"h-4 w-4 text-notion-text-muted"})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-notion-text","data-testid":"stat-rejected",children:D.rejected})})]})]}),(0,a.jsxs)(x,{className:"bg-white border border-notion-border rounded-lg shadow-sm",children:[(0,a.jsxs)(m,{className:"border-b border-notion-border",children:[(0,a.jsx)(u,{className:"text-lg font-semibold text-notion-text",children:"Driver Applications"}),(0,a.jsx)("p",{className:"text-sm text-notion-text-muted",children:"Review and manage driver applications for Neighborly"})]}),(0,a.jsxs)(p,{className:"p-0",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(f,{children:(0,a.jsxs)(j,{className:"border-b border-notion-border bg-notion-gray",children:[(0,a.jsx)(b,{className:"font-medium text-notion-text-muted py-3",children:"Driver"}),(0,a.jsx)(b,{className:"font-medium text-notion-text-muted py-3",children:"Contact"}),(0,a.jsx)(b,{className:"font-medium text-notion-text-muted py-3",children:"Vehicle"}),(0,a.jsx)(b,{className:"font-medium text-notion-text-muted py-3",children:"Status"}),(0,a.jsx)(b,{className:"font-medium text-notion-text-muted py-3",children:"Actions"})]})}),(0,a.jsx)(g,{children:null==P?void 0:P.map(e=>{var t;return(0,a.jsxs)(j,{className:"border-b border-notion-border hover:bg-notion-gray transition-colors duration-150",children:[(0,a.jsx)(v,{className:"py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-notion-text","data-testid":"text-name-".concat(e.application_id),children:e.full_name}),(0,a.jsxs)("div",{className:"text-sm text-notion-text-muted",children:["ID: ",null==(t=e.application_id)?void 0:t.slice(0,8),"..."]})]})}),(0,a.jsx)(v,{className:"py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-notion-text",children:e.email}),(0,a.jsx)("div",{className:"text-sm text-notion-text-muted",children:e.phone_number})]})}),(0,a.jsx)(v,{className:"py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-notion-text",children:[e.car.car_name," ",e.car.car_model]}),(0,a.jsx)("div",{className:"text-sm text-notion-text-muted font-mono",children:e.car.license_plate})]})}),(0,a.jsx)(v,{className:"py-4",children:(e=>{switch(e){case"pending":return(0,a.jsxs)(c,{variant:"secondary",className:"bg-notion-gray text-notion-text border-notion-border hover:bg-notion-gray-dark transition-colors duration-200",children:[(0,a.jsx)(N.A,{className:"h-3 w-3 mr-1"}),"Pending"]});case"approved":return(0,a.jsxs)(c,{variant:"secondary",className:"bg-notion-black text-white border-notion-black hover:bg-notion-text-light transition-colors duration-200",children:[(0,a.jsx)(y.A,{className:"h-3 w-3 mr-1"}),"Approved"]});case"rejected":return(0,a.jsxs)(c,{variant:"secondary",className:"bg-notion-gray text-notion-text border-notion-border hover:bg-notion-gray-dark transition-colors duration-200",children:[(0,a.jsx)(w.A,{className:"h-3 w-3 mr-1"}),"Rejected"]});default:return(0,a.jsx)(c,{variant:"outline",className:"text-notion-text-muted border-notion-border",children:e})}})(e.status)}),(0,a.jsx)(v,{className:"py-4",children:(0,a.jsxs)(i.$,{size:"sm",variant:"outline",onClick:()=>{o(e),d(!0)},className:"border-notion-border hover:bg-notion-gray text-notion-text hover:text-notion-text transition-colors duration-150","data-testid":"button-review-".concat(e.application_id),children:[(0,a.jsx)(_.A,{className:"h-4 w-4 mr-1"}),"Review"]})})]},e.application_id)})})]}),(null==P?void 0:P.length)===0&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(T.A,{className:"h-12 w-12 text-notion-text-light mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-notion-text mb-2",children:"No Applications Found"}),(0,a.jsx)("p",{className:"text-notion-text-muted",children:"There are currently no driver applications to review."})]})]})]})]}),s&&(0,a.jsx)(et,{application:s,isOpen:l,onClose:()=>{d(!1),o(null)}})]})}}}]);